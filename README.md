# Label Vision - AI Label Generator & Printer

This Next.js application allows you to upload a photo, identify items within it using AI (Genkit/Gemini), generate a concise label summary, preview the label as a PDF, and send it to a local printer via a bundled Python Flask service.

## Features

*   **Photo Upload:** Upload images from your device.
*   **AI Item Identification:** Uses Google Gemini via Genkit to identify objects in the uploaded photo.
*   **AI Label Summary:** Generates a short, relevant summary based on the identified items.
*   **Customizable Label Sizes:** Predefined standard label sizes (Small, Medium, Large, Shipping, Address).
*   **PDF Label Preview:** Renders a real-time preview of the label as a PDF.
*   **Formatting Options:** Customize font family, text alignment, and optionally include a processed (resized, B&W) version of the uploaded image on the label.
*   **Local Printer Integration:** Communicates with a bundled Python Flask backend service to:
    *   Discover available printers on the local machine.
    *   Send the generated PDF label to the selected printer.
*   **Status Indicator:** Shows the connection status to the local Python print service.
*   **Dockerized:** Includes a `Dockerfile` to build and run the combined Next.js frontend and Python backend application.

## Project Structure

*   `src/app/`: Next.js application code (App Router).
    *   `page.tsx`: Main application page component.
    *   `layout.tsx`: Root layout.
    *   `globals.css`: Global styles and Tailwind CSS theme variables.
*   `src/components/`: Reusable React components.
    *   `photo-uploader.tsx`: Handles image uploads.
    *   `item-list.tsx`: Displays identified items.
    *   `label-preview.tsx`: Shows the PDF preview and print/download actions.
    *   `ui/`: ShadCN UI components.
*   `src/ai/`: Genkit AI flow definitions.
    *   `flows/identify-items-from-photo.ts`: Flow to identify items.
    *   `flows/generate-label-from-items.ts`: Flow to generate the summary.
    *   `ai-instance.ts`: Genkit configuration.
*   `src/services/`: Client-side services.
    *   `label-printer.ts`: Generates the label PDF using `pdf-lib`.
*   `src/lib/`: Utility functions.
*   `src/hooks/`: Custom React hooks.
*   `python-print-service/`: Python Flask backend for printing.
    *   `app.py`: Flask application exposing `/api/health`, `/api/printers`, `/api/print` endpoints and serving the static Next.js app.
    *   `requirements.txt`: Python dependencies.
*   `public/`: Static assets for Next.js (if any).
*   `out/`: Static export output of the Next.js build (generated by `npm run build`). Served by Flask.
*   `docs/`: Documentation.
*   `Dockerfile`: Defines the container build process.
*   `next.config.ts`: Next.js configuration (set for static export).
*   `tailwind.config.ts`: Tailwind CSS configuration.
*   `tsconfig.json`: TypeScript configuration.
*   `package.json`: Node.js project manifest and scripts.

## Getting Started

### Prerequisites

*   Node.js (v18 or later recommended)
*   npm or yarn
*   Python (3.8 or later recommended)
*   pip
*   Docker (for containerized deployment)
*   A Google AI API Key (set as `GOOGLE_GENAI_API_KEY` environment variable). Get one from [Google AI Studio](https://aistudio.google.com/app/apikey).
*   Platform-specific printing libraries:
    *   **Windows:** `pywin32` (`pip install pywin32`)
    *   **macOS/Linux:** `pycups` (`pip install pycups`). You might also need system packages like `libcups2-dev` (Debian/Ubuntu) or equivalent.

### Environment Setup

1.  Create a `.env` file in the root directory.
2.  Add your Google AI API Key:
    ```env
    GOOGLE_GENAI_API_KEY=YOUR_API_KEY_HERE
    ```

### Running Locally (Development)

1.  **Install Frontend Dependencies:**
    ```bash
    npm install
    ```
2.  **Install Backend Dependencies:**
    ```bash
    pip install -r python-print-service/requirements.txt
    ```
3.  **Run the Genkit Development Server (optional but needed for AI features):**
    Open a separate terminal:
    ```bash
    npm run genkit:watch
    ```
4.  **Run the Python Print Service:**
    Open another separate terminal:
    ```bash
    python python-print-service/app.py
    ```
    *Note: This runs Flask in development mode, serving only the API. The Next.js dev server handles the frontend.*
5.  **Run the Next.js Development Server:**
    In the main terminal:
    ```bash
    npm run dev
    ```
6.  Open your browser to `http://localhost:9002`. The frontend will make API calls to the Python service running on `http://localhost:5001`.

### Running with Docker (Combined Deployment)

This method builds the static Next.js app and serves it along with the API from the Python Flask container.

1.  **Build the Docker Image:**
    ```bash
    docker build -t label-vision-app .
    ```
2.  **Run the Docker Container:**
    ```bash
    docker run -p 5001:5001 --env GOOGLE_GENAI_API_KEY=$GOOGLE_GENAI_API_KEY label-vision-app
    ```
    *(Replace `$GOOGLE_GENAI_API_KEY` with your actual key or use other methods like Docker secrets or `.env` file mounting if preferred for production).*
3.  Open your browser to `http://localhost:5001`. Both the frontend and the API are served from this container.

## How it Works

1.  **Frontend (Next.js):**
    *   The user uploads a photo via the `PhotoUploader` component.
    *   The `page.tsx` component handles the main state and orchestrates calls.
    *   Clicking "Identify & Summarize" triggers the `identifyItemsFromPhoto` Genkit flow.
    *   The result (identified items) is displayed in `ItemList`.
    *   The `generateSummaryFromItems` Genkit flow is called to create the label header.
    *   The `LabelPreview` component uses the summary, items, selected dimensions, and formatting options to call the `generatePdf` service (`src/services/label-printer.ts`).
    *   `generatePdf` uses `pdf-lib` to create the PDF blob in the browser.
    *   The PDF blob is displayed in an `<iframe>`.
    *   Printer list and health status are fetched from the Python backend (`/api/printers`, `/api/health`).
    *   Clicking "Print" generates the PDF again, converts it to Base64, and sends it along with the selected printer name to the Python backend's `/api/print` endpoint.
2.  **Backend (Python Flask):**
    *   The Flask app (`python-print-service/app.py`) serves the static Next.js files (from the `out/` directory generated by `npm run build`).
    *   It exposes API endpoints under `/api/`:
        *   `/api/health`: Checks if the service is running.
        *   `/api/printers`: Uses platform-specific libraries (`win32print` or `pycups`) to list available system printers.
        *   `/api/print`: Receives the Base64 PDF data and target printer name, decodes the PDF, and sends it to the specified printer using the appropriate library.
3.  **AI (Genkit):**
    *   Flows defined in `src/ai/flows/` use the configured Gemini model (`ai-instance.ts`) to perform vision and text generation tasks.

## Customization

*   **Label Sizes:** Modify the `LABEL_SIZES` constant in `src/app/page.tsx`.
*   **Styling:** Update Tailwind CSS classes or modify the theme variables in `src/app/globals.css`.
*   **PDF Layout:** Adjust the logic within `src/services/label-printer.ts`.
*   **AI Prompts:** Modify the prompts within the Genkit flow files (`src/ai/flows/`).
*   **Printing Logic:** Update the Python code in `python-print-service/app.py` if different printing libraries or options are needed.
